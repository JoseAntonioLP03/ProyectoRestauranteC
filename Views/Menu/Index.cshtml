@model IEnumerable<ProyectoRestauranteC_.Models.Categoria>

@{
    ViewData["Title"] = "Nuestra Carta";
}

@* 1. HEADER DE LA PÁGINA *@
<div class="text-center mb-12 py-8 bg-gradient-to-b from-red-50/30 to-transparent">
    <span class="text-[#E31E24] text-xs font-bold uppercase tracking-[0.4em] block mb-3">Descubre Nuestros Sabores</span>
    <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-gray-900">Nuestra <span class="text-[#E31E24]">Carta</span></h1>
    <div class="w-16 h-0.5 bg-[#E31E24] mx-auto mt-4"></div>
</div>

@* 2. MINI MENÚ DE CATEGORÍAS (Sticky) *@
<div class="sticky top-20 z-40 bg-white/98 backdrop-blur-md py-5 mb-10 shadow-sm border-t-2 border-[#E31E24]">
    <div class="container mx-auto px-4">
        <div class="flex flex-wrap justify-center gap-6 md:gap-10">
            @foreach (var cat in Model)
            {
                <a href="#cat-@cat.Id"
                   class="text-xs font-semibold uppercase tracking-wider text-gray-600 hover:text-[#E31E24] transition-colors duration-300 pb-1 border-b-2 border-transparent hover:border-[#E31E24]">
                    @cat.Nombre
                </a>
            }
        </div>
    </div>
</div>

@* 3. LISTADO DE PRODUCTOS POR CATEGORÍA *@
<div class="container mx-auto px-4 space-y-20 pb-16">
    @{
        int index = 0;
    }
    @foreach (var categoria in Model)
    {
        var isEven = index % 2 == 0;
        <section id="cat-@categoria.Id" class="scroll-mt-28">
            @* Título de Categoría con fondo alternado *@
            <div class="mb-8 pb-4 pt-6 px-6 rounded-lg @(isEven ? "bg-red-50/50 border-l-4 border-[#E31E24]" : "bg-gray-50 border-l-4 border-gray-300")">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-2 h-2 bg-[#E31E24] rounded-full"></div>
                    <h2 class="text-2xl md:text-3xl font-bold tracking-tight text-gray-900">@categoria.Nombre</h2>
                </div>
                @if (!string.IsNullOrEmpty(categoria.Descripcion))
                {
                    <p class="text-gray-600 text-sm italic ml-5">@categoria.Descripcion</p>
                }
            </div>

            @* Grid de Produtos *@
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                @foreach (var producto in categoria.Productos.Where(p => p.Disponible))
                {
                    <div class="group bg-white border border-gray-200 hover:border-[#E31E24] transition-all duration-300 overflow-hidden rounded-lg hover:shadow-lg hover:shadow-red-100">
                        @* Imagen *@
                        @if (!string.IsNullOrEmpty(producto.ImagenUrl))
                        {
                            <div class="relative overflow-hidden aspect-[16/10] bg-gray-100">
                                <img src="@producto.ImagenUrl" 
                                     alt="@producto.Nombre" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                                @* Badge decorativo en la imagen *@
                                <div class="absolute top-2 left-2 w-2.5 h-2.5 bg-[#E31E24] rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            </div>
                        }

                        <div class="p-4">
                            @* Nombre y Precio *@
                            <div class="flex items-start justify-between gap-2 mb-2">
                                <h3 class="text-base font-semibold text-gray-900 leading-snug flex-1">@producto.Nombre</h3>
                                <span class="text-[#E31E24] font-bold text-base whitespace-nowrap bg-red-50 px-2 py-0.5 rounded">@producto.Precio€</span>
                            </div>

                            @* Separador decorativo *@
                            <div class="w-10 h-0.5 bg-gradient-to-r from-[#E31E24] to-transparent mb-2"></div>

                            @* Descripción *@
                            <p class="text-gray-600 text-xs leading-relaxed mb-3 line-clamp-2">
                                @(producto.Descripcion ?? "Delicioso plato preparado con ingredientes frescos.")
                            </p>

                            @* Botón de Acción *@
                            <button class="w-full bg-[#E31E24] text-white py-2 px-3 rounded-md text-xs font-medium uppercase tracking-wide hover:bg-[#c51a1f] transition-colors duration-300 active:scale-98 shadow-sm hover:shadow-md">
                                Añadir al pedido
                            </button>
                        </div>
                    </div>
                }
            </div>

            @* Separador entre categorías *@
            @if (index < Model.Count() - 1)
            {
                <div class="mt-16 flex items-center gap-4">
                    <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
                    <div class="flex gap-1">
                        <div class="w-1.5 h-1.5 bg-[#E31E24] rounded-full"></div>
                        <div class="w-1.5 h-1.5 bg-[#E31E24] rounded-full opacity-60"></div>
                        <div class="w-1.5 h-1.5 bg-[#E31E24] rounded-full opacity-30"></div>
                    </div>
                    <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"></div>
                </div>
            }
        </section>
        index++;
    }
</div>

@section Scripts {
    <script>
        // Scroll suave al hacer click en el menú de categorías
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Resaltar categoría activa en el menú
        const sections = document.querySelectorAll('section[id^="cat-"]');
        const navLinks = document.querySelectorAll('a[href^="#cat-"]');
        
        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            }); 

            navLinks.forEach(link => {
                link.classList.remove('text-[#E31E24]', 'border-[#E31E24]');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('text-[#E31E24]', 'border-[#E31E24]');
                }
            });
        });
    </script>
}